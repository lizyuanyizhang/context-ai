# 中文语音支持改进说明

## 问题描述

用户反馈：
1. 语音无法播放
2. 翻译结果上有发音标识，但无法发中文

## 已实施的改进

### 1. 扩展语言支持

**之前**：只支持英语（en）和德语（de）

**现在**：支持英语（en）、德语（de）和中文（zh）

```typescript
export type SupportedLanguage = 'en' | 'de' | 'zh'
```

### 2. 添加中文语言配置

```typescript
zh: {
  lang: 'zh-CN', // 简体中文
  rate: 0.9,
  pitch: 1.0,
  volume: 1.0
}
```

### 3. 改进语言检测

现在可以检测中文文本：

```typescript
// 检测中文字符
const chineseChars = /[\u4e00-\u9fa5]/
if (chineseChars.test(text)) {
  return 'zh'
}
```

### 4. 系统语音支持检测

- ✅ 自动检测系统是否支持中文语音
- ✅ 如果不支持，提供详细的安装指南
- ✅ 改进错误提示，包含解决方案

### 5. 分离原文和翻译的语音朗读

- ✅ 原文按钮：朗读原始选中的文本（英文/德文）
- ✅ 翻译按钮：朗读翻译结果（中文）
- ✅ 如果系统不支持中文语音，会提示用户如何安装

## 使用方法

### 朗读原文

1. 选择英文或德文文字
2. 点击"翻译"按钮
3. 在翻译面板中，点击原文旁边的语音按钮（🔊）
4. 应该能听到原文的语音朗读

### 朗读翻译结果

1. 翻译完成后
2. 点击翻译结果旁边的语音按钮（🔊）
3. **如果系统支持中文语音**：会播放中文翻译
4. **如果系统不支持中文语音**：会显示安装指南

## 系统要求

### macOS

1. 打开"系统偏好设置"
2. 点击"辅助功能"
3. 选择"朗读内容"
4. 点击"管理语音..."
5. 添加中文语音包（如"Ting-Ting"或"Sin-Ji"）

### Windows

1. 打开"设置"
2. 选择"时间和语言"
3. 选择"语音"
4. 点击"管理语音"
5. 添加中文语音包

### Linux

安装中文 TTS 引擎：

```bash
# Ubuntu/Debian
sudo apt-get install espeak-zh

# 或其他 TTS 引擎
```

## 技术细节

### 语音检测流程

1. **检测文本语言**：使用 `detectLanguage()` 检测文本是中文、英文还是德文
2. **检查系统支持**：使用 `getVoices()` 检查系统是否支持该语言的语音
3. **选择最佳语音**：优先选择本地语音（localService = true）
4. **错误处理**：如果不支持，提供详细的错误信息和解决方案

### 代码改进

```typescript
// 改进前：不支持中文
export type SupportedLanguage = 'en' | 'de'

// 改进后：支持中文
export type SupportedLanguage = 'en' | 'de' | 'zh'
```

```typescript
// 改进前：简单的错误提示
alert('语音播放失败')

// 改进后：详细的错误信息和解决方案
if (detectedLang === 'zh' && !supportsChinese) {
  error = new Error('系统不支持中文语音。\n\n解决方案：...')
}
```

## 测试步骤

### 1. 测试原文语音

1. 选择一段英文文字
2. 点击"翻译"按钮
3. 点击原文旁边的语音按钮
4. ✅ 应该能听到英文语音

### 2. 测试翻译语音（如果系统支持中文）

1. 翻译一段文字
2. 等待翻译完成
3. 点击翻译结果旁边的语音按钮
4. ✅ 如果系统支持中文，应该能听到中文语音

### 3. 测试翻译语音（如果系统不支持中文）

1. 翻译一段文字
2. 等待翻译完成
3. 点击翻译结果旁边的语音按钮
4. ✅ 应该显示详细的安装指南

## 常见问题

### Q: 为什么中文语音无法播放？

A: 可能的原因：
1. 系统没有安装中文语音包
2. 浏览器不支持中文语音
3. 语音权限被拒绝

**解决方案**：
- 按照错误提示中的步骤安装中文语音包
- 检查浏览器权限设置
- 尝试刷新页面后重试

### Q: 如何知道系统是否支持中文语音？

A: 在浏览器控制台运行：

```javascript
// 检查中文语音
const synthesis = window.speechSynthesis
const voices = synthesis.getVoices()
const chineseVoices = voices.filter(v => v.lang.startsWith('zh'))
console.log('中文语音：', chineseVoices)
```

### Q: 可以添加其他语言支持吗？

A: 可以！只需要：
1. 在 `SupportedLanguage` 类型中添加新语言
2. 在 `LANGUAGE_CONFIGS` 中添加配置
3. 在 `detectLanguage()` 中添加检测逻辑

## 下一步优化建议

1. **缓存语音列表**：避免每次都要获取语音列表
2. **语音选择器**：让用户选择使用哪个语音
3. **语音预览**：播放一小段让用户试听
4. **多语言支持**：添加更多语言（法语、西班牙语等）
